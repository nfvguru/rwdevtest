<!doctype html>
<html lang="en">
{% load static %}
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.0.1">
    <title>FRAMEWORK FOR  DEV  TESTING</title>
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.css' %}">
<link rel="apple-touch-icon" href="/docs/4.5/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/docs/4.5/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/docs/4.5/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/docs/4.5/assets/img/favicons/manifest.json">
<link rel="mask-icon" href="/docs/4.5/assets/img/favicons/safari-pinned-tab.svg" color="#563d7c">
<link rel="icon" href="/docs/4.5/assets/img/favicons/favicon.ico">
<meta name="msapplication-config" content="/docs/4.5/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#563d7c">
    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <link href="album.css" rel="stylesheet">
  </head>
  <body>
<main role="main">
  <section class="jumbotron text-center">
    <div class="container">
      <h1>RWFW VA TESTER MASTER</h1>
      <h3>{{ tpname }}</h3>
      <img src="{{ tpurl.url }}" height=200>
      <p>
      <a href="http://{{ request.get_host }}/ImageManager" class="btn btn-primary my-2">Back</a>
      </p>
      <!-- <p>{{ task_id }}{{ task_status }}{{ task_results }}</p> -->
    </div>
    <!-- <h4> Visit Count = {{ visit_count }}</h4> -->
  </section>
{% if vertable %}
<div>
<table style="border:1px solid black;margin-left:auto;margin-right:auto;" width=1000>
  <tr style="border:1px solid black;" >
    <th colspan="4" align='center'>Available Versions</th>
  </tr>
{% for item in vertable %}
<tr style="border:1px solid black;background-color:lightblue; color:white;" >
  <td width='600'><strong>{{item.repo_verson}}</strong></td>

  <!-- <td><a href="http://{{ request.get_host }}/Download/{{item.repo_verson}}/0" class="btn btn-primary my-2"> Check and get Latest </a></td> -->
  <!-- <td><a href="{% url 'download' task_id=repoid task_version=item.repo_verson task_build=0 %}" class="btn btn-primary my-2"> Check and get Latest </a></td> -->
  <td width='200'>
    <input type="button" id='check_build' value=" Check Latest"
     onclick="chkDownload('{% url 'download' task_id=repoid task_version=item.repo_verson task_build=0 %}', '{{item.repo_verson}}_text')" />
  <!-- <p id='progress-bar'></p> -->
  </td>
  <td width='300'>
    Build :
    <input type="text" id='{{item.repo_verson}}_text' onchange="enablDButton('{{item.repo_verson}}_text')"/>
    <!-- <datalist id="builds">
    </datalist> -->
  </td>
  <td width='100'>
      <input id="dwnLoad" type="button" value=" Download" disabled=True
        onclick="doDownload('{{repoid}}','{{item.repo_verson}}', '{{item.repo_verson}}_text')"
       />
  </td>
</tr>
{% endfor %}
</table>
<table style="margin-left:auto;margin-right:auto;" width=1000>
  <tr style="" >
    <th colspan="4" align='center'>
      <p id='progress-bar'></p>
    </th>
  </tr>
</table>
</div>
{% endif %}
  <div class="album py-5 bg-light">
    <div class="container">

      <div class="row">

{% for item in downtable %}
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <!-- <a href="{{BASE_UR}}/ListHost/{{item.type_name}}">
            <img class="card-img-top" src="{{item.type_img.url}}" height=200>
            </a> -->
            <div class="card-body">
              <!-- <a href="{{BASE_UR}}/ListHost/{{item.type_name}}"> -->
		            <p class="card-text">
                  <strong>{{item.dwn_version}} :  {{item.dwn_build}}</strong>
                  <!-- :&emsp;&emsp;
                  <img src="
                  {% if  reachable %}
                  {% static 'ON.PNG' %}
                  {% else %}
                  {% static 'OFF.PNG' %}
                  {% endif %}
                  " height=30 width=30> -->
                  <!-- <img src="{% static 'OFF.PNG' %}" height=30 width=30> -->
                  <!-- {{item.host_user}} -->
                  <!-- {{item.host_pass}} -->
                </p>
              <!-- </a> -->
              <!-- <p class="card-text">{{item.item_desc}}</p> -->
            </div>
          </div>
        </div>
{% endfor %}
      </div>
    </div>
  </div>
</main>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script>
var progressTitle = document.getElementById('progress-bar');
var checkItem = document.getElementById('check_build');
var dwnLoadItem = document.getElementById('dwnLoad');
var updateUrl = '{{BASE_UR}}/StatusDownload/';

var build = -1;

function updateProgressTitle()  {
    progressTitle.innerHTML += '.';
}

function updateProgress (progressUrl, textItem, mode) {
    fetch(progressUrl).then(function(response) {
        response.json().then(function(data) {
            //alert("I am an alert box!");
            updateProgressTitle();
            if (data.task_status == "SUCCESS") {
              // var textItem = document.getElementById(txtname);
              if(mode == 1) {
                 build = data.task_build;
                 if(build == -1 ){
                   progressTitle.innerHTML += " Error in fetching latest build details."
                 } else {
                    progressTitle.innerHTML += ' build ' + data.task_build + ' is available';
                    dwnLoadItem.disabled = false;
                    // checkItem.disabled = false;
                     textItem.value = build;
                  }
                  textItem.disabled = false;
              } else {
                 window.location.reload();
              }
            } else {
              setTimeout(updateProgress, 500, progressUrl, textItem, mode);
            }

        });
    });
}

function chkDownload(startUrl, txtname){
  var textItem = document.getElementById(txtname);
  textItem.disabled = true;
  checkItem.disabled = true;
  progressTitle.innerHTML = 'Checking ..';
  fetch(startUrl).then(function(response) {
      response.json().then(function(data) {
          progressUrl = updateUrl + data.t_id;
          updateProgress(progressUrl, textItem, 1);
      });
  });
}

function doDownload(myid, myver, myfld) {
  var fldElement = document.getElementById(myfld);
  alert(build)
  if ( build != -1 ) {
    var bldval = 0;
  } else {
    var bldval = fldElement.value;
  }
  var downUrl ='{{BASE_UR}}/DoDownload';
  downUrl += '/' + myid + '/' + myver + '/' + bldval;
  alert(downUrl);
  progressTitle.innerHTML = 'Downloading ..';
  fetch(downUrl).then(function(response) {
      response.json().then(function(data) {
          alert(data.t_id);
          progressUrl = updateUrl + data.t_id;
          alert(progressUrl);
          updateProgress(progressUrl, fldElement, 2);
      });
  });
}

function enablDButton(txtname){
  //alert('vannu')
  dwnLoadItem.disabled = false;
}
</script>

  </body>
</html>
